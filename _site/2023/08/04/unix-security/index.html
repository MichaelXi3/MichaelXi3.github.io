<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="theme-color" content="#000000">

    <!-- Open Graph -->
    <meta property="og:title"
        content="Unix Security - Sphere | Xi">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="UNIX Introduction
">
    
    <meta property="article:published_time" content=" 2023-08-04T00:00:00Z">
    
    
    <meta property="article:author" content="Michael Xi">
    
    
    <meta property="article:tag" content="Unix">
    
    <meta property="article:tag" content="Linux">
    
    <meta property="article:tag" content="Security">
    
    <meta property="article:tag" content="System">
    
    
    <meta property="og:image" content="http://localhost:4000">
    <meta property="og:url" content="http://localhost:4000/2023/08/04/unix-security/">
    <meta property="og:site_name" content="Sphere | Xi">

    <title>Unix Security - Sphere | Xi</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2023/08/04/unix-security/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href=" /css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href=" /css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-6487568398225121" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Sphere</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/ubuntu.jpeg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/ubuntu.jpeg');
        background: ;
    }

    
</style>




<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Unix" title="Unix">Unix</a>
                        
                        <a class="tag" href="/archive/?tag=Linux" title="Linux">Linux</a>
                        
                        <a class="tag" href="/archive/?tag=Security" title="Security">Security</a>
                        
                        <a class="tag" href="/archive/?tag=System" title="System">System</a>
                        
                    </div>
                    <h1>Unix Security</h1>
                    
                    <h2 class="subheading">A comprehensive introduction to Unix security</h2>
                    <span class="meta">Posted by Michael Xi on August 4, 2023</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h1 id="unix-introduction">UNIX Introduction</h1>

<h3 id="operating-systems-and-security">Operating Systems and Security</h3>

<blockquote>
  <p>OS security typically consists of the following <strong>four</strong> items</p>

</blockquote>

<ol>
  <li><strong>Login and user accounts</strong>
    <ul>
      <li>Info about users is stored in accounts</li>
      <li>This includes <em>privileges</em> granted to a user</li>
      <li><em>Identification</em> and <em>authentication</em> identify a user</li>
    </ul>
  </li>
  <li><strong>Access control</strong>
    <ul>
      <li><em>Permissions</em> on resources can be set by the admin</li>
      <li>Permissions will depend on the user’s identity</li>
    </ul>
  </li>
  <li><strong>Audits</strong>
    <ul>
      <li>Security involves the <em>prevention</em> and <em>detection</em></li>
      <li>Mechanisms are needed to determine security violations</li>
    </ul>
  </li>
  <li><strong>Configuration management</strong>
    <ul>
      <li>Updating OS based on security needs</li>
    </ul>
  </li>
</ol>

<h3 id="unix-background">UNIX Background</h3>

<p>UNIX is originally intended for one computer with multiple users</p>

<ul>
  <li>So that user mistakes can be isolated</li>
  <li>The initial UNIX design didn’t have security in mind, the trust association is: If you connect to the mainframe, then I must trust you</li>
</ul>

<h1 id="unix-system--security">UNIX System &amp; Security</h1>

<h3 id="unix-mechanisms">UNIX Mechanisms</h3>

<p><img src="https://s2.loli.net/2023/08/05/P4bFwjroKt8iGHn.png" alt="截屏2023-08-04 下午9.47.39.png" /></p>

<ul>
  <li>UNIX program runs as either <code class="language-plaintext highlighter-rouge">kernel</code> or <code class="language-plaintext highlighter-rouge">user</code>,  which corresponds to complete or limited control of all resources</li>
</ul>

<h3 id="runlevel">Runlevel</h3>

<p><strong>Runlevel</strong> is a state or mode state of the machine after boot. It defines what the computer does in a general sense.</p>

<ul>
  <li>
    <p>There are <strong>Seven</strong> run levels
  <img src="https://s2.loli.net/2023/08/05/VoiCsIcNrbwSQDG.png" alt="截屏2023-08-04 下午9.49.26.png" /></p>

    <blockquote>
      <p>For example, our AWS VM has a run level equal to 5, so we have a graphical user interface. To check the run level, use <code class="language-plaintext highlighter-rouge">runlevel</code> in CLI.</p>

    </blockquote>

    <p>The system’s run level gives you an idea of the computer, e.g. whether it’s a single-user computer, a server, etc.</p>
  </li>
  <li>
    <p>Consider UNIX system booting</p>

    <p><img src="https://s2.loli.net/2023/08/05/PCzlqFLayXfRDJn.png" alt="截屏2023-08-04 下午9.51.58.png" /></p>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">init</code> process starts → kick off everything</li>
      <li><code class="language-plaintext highlighter-rouge">init</code> determines the default run level (set by admin)</li>
      <li><code class="language-plaintext highlighter-rouge">init</code> runs the scripts associated with the run level, which are located in the<code class="language-plaintext highlighter-rouge">/etc</code> directory with one directory per run level</li>
    </ol>
  </li>
</ul>

<h3 id="login-and-user-accounts">Login and User Accounts</h3>

<h4 id="password">Password</h4>

<ul>
  <li>In UNIX, users are identified by <strong>user names</strong>
    <ul>
      <li>Authenticated by passwords</li>
      <li>Passwords are <strong><em>encrypted</em></strong> and stored in <code class="language-plaintext highlighter-rouge">/etc/passwd</code></li>
    </ul>
  </li>
  <li>
    <p>In <code class="language-plaintext highlighter-rouge">/etc/passwd</code>, every user’s row looks like this:</p>

    <p><img src="https://s2.loli.net/2023/08/05/7zbVoFAfKcY8BXg.png" alt="截屏2023-08-04 下午9.53.31.png" /></p>

    <p>The root user always has <code class="language-plaintext highlighter-rouge">UID = 0</code>, which provides the highest level of permissions in Unix</p>

    <ul>
      <li>If the password is empty, the password is not required</li>
      <li>If the password starts with an <code class="language-plaintext highlighter-rouge">*</code>, the user cannot log in</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/etc/passwd</code> is readable by any user (in the good old days), but only root can write to this file</p>

    <ul>
      <li><strong>Security risk</strong>: user can elevate privileges by <code class="language-plaintext highlighter-rouge">setuid</code> and modify readonly files</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">/etc/passwd</code> and <strong>Shell</strong>
    <ul>
      <li>
        <p>Shell is the command line environment given to the account</p>

        <p><img src="https://s2.loli.net/2023/08/05/wPTpH8oyb3DLemv.png" alt="截屏2023-08-04 下午9.56.01.png" /></p>
      </li>
      <li>If the shell is <code class="language-plaintext highlighter-rouge">/usr/sbin/nologin</code> or <code class="language-plaintext highlighter-rouge">/bin/false</code> then <strong>Cannot</strong> log in</li>
      <li>
        <p>Why have an account you cannot log into?</p>

        <blockquote>
          <p>Every process has to be run by an owner, so the admin may want to create a user to run certain processes. So that admin can kill these processes by killing the corresponding user.</p>

          <ol>
            <li>Security: In some cases, a process or service may require access to certain system resources, such as files or network ports, but does not need a user shell or interactive login. By creating a dedicated system account for the process or service, system administrators can restrict access to the necessary resources while minimizing the risk of unauthorized access.</li>
            <li>Process isolation: Sometimes, it is necessary to create a user account to run a particular process, but it is not desirable to allow the user to log in interactively or run other programs. For example, a web server may need a dedicated user account to run its processes, but that user should not have shell access or be able to run other programs on the system.</li>
            <li>Backup purposes: Creating system accounts for backup purposes, such as for system-level backups, allows for a clean and organized environment. It also helps to ensure that no user or program can interfere with the backup process.</li>
          </ol>
        </blockquote>
      </li>
    </ul>
  </li>
  <li><strong>Shadow Files</strong>
    <ul>
      <li>There is a security risk with a readable password, so people create shadow files to store hashed passwords now</li>
      <li>If a shadow password file is used
        <ul>
          <li>
            <p>An x is placed for the password in <code class="language-plaintext highlighter-rouge">/etc/passwd</code></p>

            <p><img src="https://s2.loli.net/2023/08/05/YMiTfOS4IJWeoym.png" alt="截屏2023-08-04 下午9.57.31.png" /></p>
          </li>
          <li>
            <p>The actual encrypted password is located in <code class="language-plaintext highlighter-rouge">/etc/shadow</code> and this file is readable only by the <strong>root</strong></p>

            <p><img src="https://s2.loli.net/2023/08/05/jQwfHRYKP6SOk7I.png" alt="截屏2023-08-04 下午9.58.02.png" /></p>
          </li>
        </ul>
      </li>
      <li>To crack the password, you need to crack these two files and merge them. You also can use <strong><a href="https://github.com/openwall/john">John the Ripper (JTR)</a></strong> to do the cracking automatically.</li>
    </ul>
  </li>
  <li>
    <p><strong>Interpret</strong> <code class="language-plaintext highlighter-rouge">/etc/shadow</code> file meanings</p>

    <p><img src="https://s2.loli.net/2023/08/05/WZPlvX8Um61Mfn2.png" alt="截屏2023-08-04 下午9.59.21.png" /></p>
  </li>
</ul>

<h4 id="user-types">User Types</h4>

<ul>
  <li><strong>User Types</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Root</code> is superuser that has complete control of the system
        <ul>
          <li>Root has <code class="language-plaintext highlighter-rouge">UID = 0</code> and can do almost everything</li>
          <li>Root <strong>can</strong> become any other user, change passwd file</li>
          <li>Root <strong>cannot</strong> change system read-only file</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">Normal user</code> can log in to the system with restricted access</li>
      <li><code class="language-plaintext highlighter-rouge">System user</code> cannot log in, and their accounts are used for specific system purposes.</li>
    </ul>
  </li>
  <li><strong>UNIX User UID and Group IDs</strong>
    <ul>
      <li>
        <p>UNIX represents users by a user name and a user ID. UID is linked to user name in the passwd file</p>

        <p><img src="https://s2.loli.net/2023/08/05/52XyVo8KgJLAeti.png" alt="截屏2023-08-05 上午12.48.12.png" /></p>
      </li>
      <li>
        <p><strong>Group ID</strong>: Collecting users in groups for access control</p>

        <p><img src="https://s2.loli.net/2023/08/05/ipSVWMRvHk6rGaw.png" alt="截屏2023-08-05 上午12.49.22.png" /></p>
      </li>
    </ul>
  </li>
</ul>

<h4 id="discussion-about-root-privilege-control"><strong>Discussion about Root Privilege Control</strong></h4>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sudo</code>, a more controlled method to share root. <code class="language-plaintext highlighter-rouge">sudo = superuser do</code></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">sudo</code> can specify the allowed privileged commands → prevent sudo - all or nothing (more granularity)</p>

        <p><img src="https://s2.loli.net/2023/08/05/81sOTAuWfxPNLSI.png" alt="截屏2023-08-05 上午12.50.19.png" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sudoers.d</code> is a directory containing files specifying the permissions per group or user</p>

    <ul>
      <li>The file path is <code class="language-plaintext highlighter-rouge">/etc/sudoers.d</code>, and the idea is the same as <code class="language-plaintext highlighter-rouge">sudoers</code>, we just place entries in separate files</li>
      <li>This change was done to prevent mistakes while updating <code class="language-plaintext highlighter-rouge">sudo</code> permissions, The file <code class="language-plaintext highlighter-rouge">sudoers</code> still exist even with this update</li>
    </ul>

    <p><img src="https://s2.loli.net/2023/08/05/1WdZaqhpo3F2ly4.png" alt="截屏2023-08-05 上午12.54.10.png" /></p>
  </li>
  <li>
    <p><strong>Controlled Invocation →</strong> a more careful way of giving privilege than sudo</p>

    <ul>
      <li>UNIX may occasionally need superuser privilege to perform certain tasks</li>
      <li>The solution is <strong>Set User ID</strong> (<code class="language-plaintext highlighter-rouge">SUID</code>) and <strong>Set Group ID</strong> (<code class="language-plaintext highlighter-rouge">SGID</code>) <strong>programs</strong>
        <ul>
          <li><strong>Programs</strong> that are SUID give a user a different status during their execution, then return to normal once complete</li>
          <li>
            <p>The list of programs that has <strong>SUID</strong> bit turned on is: (You can also write your own <code class="language-plaintext highlighter-rouge">setuid()</code> program)</p>

            <p><img src="https://s2.loli.net/2023/08/05/zhmPWQygtoI86rX.png" alt="截屏2023-08-05 上午12.56.05.png" /></p>

            <p>In UNIX, the <strong><code class="language-plaintext highlighter-rouge">perm -4000</code></strong> option is used as the <strong><code class="language-plaintext highlighter-rouge">find</code></strong> command searches for files with the “<code class="language-plaintext highlighter-rouge">setuid</code>” bit set. This special permission bit allows a program to be executed with the privileges of the file owner, rather than the user executing the program. It is used to give users temporary elevated privileges to perform certain tasks requiring special permissions.</p>
          </li>
        </ul>
      </li>
      <li>
        <p>A program that sets the UID looks like this:</p>

        <p><img src="https://s2.loli.net/2023/08/05/VqGQO471SYKAljy.png" alt="截屏2023-08-05 上午12.57.24.png" /></p>

        <ul>
          <li>SUID program is very dangerous in terms of security, because people could hack you during the program is root, such as spawn a shell.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="unix-file-structure">UNIX File Structure</h3>

<ul>
  <li>UNIX arranges files in a <strong>tree</strong> structure.
    <ul>
      <li>The base of the tree is called the root <code class="language-plaintext highlighter-rouge">/</code></li>
      <li>The system consists of files and directories</li>
      <li>Every directory contains two files <code class="language-plaintext highlighter-rouge">.</code> and <code class="language-plaintext highlighter-rouge">..</code></li>
      <li>Every file has an owner and belongs to a group</li>
    </ul>
  </li>
  <li>
    <p>For each file, the representation is:</p>

    <p><img src="https://s2.loli.net/2023/08/05/GybrlBWRQjoKtH4.png" alt="截屏2023-08-05 上午1.00.51.png" /></p>

    <ul>
      <li>First character indicates if the file is a directory <code class="language-plaintext highlighter-rouge">d</code></li>
      <li><code class="language-plaintext highlighter-rouge">rwx</code> means read, write, and execute</li>
    </ul>
  </li>
  <li>
    <p>If the file is a <strong>SUID</strong> program, then the representation is:</p>

    <p><img src="https://s2.loli.net/2023/08/05/6zWtLcQJ14XlT9p.png" alt="截屏2023-08-05 上午1.02.33.png" /></p>

    <ul>
      <li>The reason why <code class="language-plaintext highlighter-rouge">s</code> is used in place of <code class="language-plaintext highlighter-rouge">x</code> when the <code class="language-plaintext highlighter-rouge">setuid</code> or <code class="language-plaintext highlighter-rouge">setgid</code> bit is set on a file is to indicate that the execute bit is implicitly set along with the special bit</li>
    </ul>
  </li>
  <li>To change the permissions of a file, use the command <code class="language-plaintext highlighter-rouge">chmod</code>
    <ul>
      <li>Add permission → <code class="language-plaintext highlighter-rouge">chmod who+perm fileName</code></li>
      <li>Remove permission → <code class="language-plaintext highlighter-rouge">chmod who-perm fileName</code></li>
    </ul>
  </li>
  <li>
    <p>Check detailed information about file via <code class="language-plaintext highlighter-rouge">stat</code> command</p>

    <p><img src="https://s2.loli.net/2023/08/05/CtxXEsbv6T23UFf.png" alt="截屏2023-08-05 上午1.05.45.png" /></p>
  </li>
</ul>

<h3 id="unix-command-shell">UNIX Command Shell</h3>

<h4 id="bash-environment">Bash Environment</h4>

<p>Bash keeps track of settings and details through an area it maintains called the <strong><em>environment</em></strong>.</p>

<ul>
  <li>Environment is an area that is built every time that a session is started</li>
  <li>Contains variables that define system properties</li>
  <li>
    <p>To display the variables, use the command <code class="language-plaintext highlighter-rouge">env</code> or <code class="language-plaintext highlighter-rouge">printenv</code></p>
  </li>
  <li>Every time a shell session started:
    <ul>
      <li>A process takes place to gather and compile information that should be available to the shell process and its child processes</li>
    </ul>
  </li>
</ul>

<h4 id="environment-variable-and-shell-variable">Environment Variable and Shell Variable</h4>

<ul>
  <li>
    <p>What is <strong>Environment Variable</strong>?</p>

    <p>Environment variables are named dynamic values (often set by OS)</p>

    <ul>
      <li>Should be considered <strong><em>hidden</em></strong> <strong>input</strong>, and it may affact program behavior</li>
      <li>Ignoring how they are set is dangerous</li>
      <li>When executed, a program may use these variables for system access
        <ul>
          <li>Such as <code class="language-plaintext highlighter-rouge">PATH</code>, <code class="language-plaintext highlighter-rouge">IFS</code>, <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>, and <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code></li>
        </ul>
      </li>
    </ul>

  	<img src="https://s2.loli.net/2023/08/05/vfinLQjZPFEm1Xu.png" alt="截屏2023-08-05 上午1.08.32.png" />

  	To check current environment variables, use <code class="language-plaintext highlighter-rouge">printenv</code> command.
  </li>
  <li>
    <p>How to create Environment Variable?</p>

    <ul>
      <li>
        <p>Environment variables can be created from local shell variables by <code class="language-plaintext highlighter-rouge">export</code></p>

        <p><img src="https://s2.loli.net/2023/08/05/4MmKeDCUAhrHxGb.png" alt="截屏2023-08-05 上午1.10.06.png" /></p>
      </li>
      <li>
        <p>You can also create environment variable using <code class="language-plaintext highlighter-rouge">env</code> command</p>

        <p><img src="https://s2.loli.net/2023/08/05/e43cTLzJuxw6WZy.png" alt="截屏2023-08-05 上午1.10.36.png" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>What is <strong>Bash Variable</strong> or <strong>Shell Variable</strong> (a more general term)?</p>

    <p>Bash is a command line interface for the OS, and is also a programming/scripting language. Bash allows using <code class="language-plaintext highlighter-rouge">=</code> to declare variables</p>

    <ul>
      <li>These variables are used to manage <strong>ephemeral</strong> data, like current working directory</li>
      <li>
        <p>They are contained within the shell in which they were set or defined</p>

        <p><img src="https://s2.loli.net/2023/08/05/uqJBbvkFLOIpcxS.png" alt="截屏2023-08-05 上午1.12.20.png" /></p>
      </li>
      <li>
        <p>What is the <strong>difference</strong> between <strong>Environmental variable and Bash variable</strong>?</p>

        <p><strong>Environment variables</strong> are system-wide variables that are set and used by all programs running on a machine, while <strong>bash variables</strong> are specific to the shell or command being executed.</p>

        <p>Environment variables can be set by the operating system or by users, and they provide information about the system and its configuration. Bash variables, on the other hand, are used to store information that is specific to a particular shell or command, such as the output of a command or a user-defined value. Bash variables are not accessible outside of the shell or command in which they are defined, while environment variables can be accessed by any program running on the machine.</p>
      </li>
      <li>
        <p>What is the difference between <strong>Bash and Shell variable</strong>?</p>

        <p>A shell variable and a bash variable are essentially the same thing, but they are often used in different contexts. “Shell variable” is a more general term that refers to a variable within any Unix-like shell (e.g., sh, bash, zsh, ksh, etc.), while “bash variable” specifically refers to a variable within the Bash (Bourne Again Shell) environment.</p>

        <p>Both types of variables are used to store and manipulate data in the shell environment, and they can be set, accessed, and modified using shell scripting. However, the distinction is mainly based on the context in which they are used.</p>

        <ul>
          <li>Shell variable: A variable used within any Unix-like shell environment. It is a more general term.</li>
          <li>Bash variable: A variable specifically used within the Bash shell environment.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="shell-shock">Shell Shock</h4>

<ul>
  <li>
    <p>Bash environment variables can also <strong>export function definitions</strong></p>

    <p><img src="https://s2.loli.net/2023/08/05/MxjNPvVZcgTGX3H.png" alt="截屏2023-08-05 上午1.17.32.png" /></p>

    <ul>
      <li>If a variable string starts with <code class="language-plaintext highlighter-rouge">() {</code>, then this is a function</li>
    </ul>
  </li>
  <li>
    <p>The cases of shell shock</p>

    <p><img src="https://s2.loli.net/2023/08/05/YOiKl2JPudNkVq9.png" alt="截屏2023-08-05 上午1.19.09.png" /></p>

    <ul>
      <li>For the third command, <code class="language-plaintext highlighter-rouge">echo bar</code> should not be executed at all</li>
      <li>Thus, this bash issue allows arbitrary command execution</li>
    </ul>
  </li>
</ul>

<h4 id="path">PATH</h4>

<ul>
  <li>Users interact with the OS through a shell, such as <code class="language-plaintext highlighter-rouge">zsh</code>, <code class="language-plaintext highlighter-rouge">bash</code>, etc.</li>
  <li>As a matter of convenience users can type run a program command without specifying the complete path. For example, to run <code class="language-plaintext highlighter-rouge">ls</code>, you don’t need to type <code class="language-plaintext highlighter-rouge">/bin/ls</code>.
    <ul>
      <li>The shell knows where to look using a PATH variable</li>
    </ul>
  </li>
  <li>The PATH environment variable lists the directories to search and it’s defined in <code class="language-plaintext highlighter-rouge">.cshrc</code> or <code class="language-plaintext highlighter-rouge">.bashrc</code> file depending on the shell you use and located at the home directory.
    <ul>
      <li>
        <p>The <strong>order matters</strong>! It determines the commands look-up sequence of the shell.</p>

        <p><img src="https://s2.loli.net/2023/08/05/bEhpr8qR5GvWoHu.png" alt="截屏2023-08-05 上午1.21.13.png" /></p>
      </li>
    </ul>
  </li>
</ul>

<p><strong>Path Attack</strong></p>

<blockquote>
  <p>Using path attack to trick system admin to get the root shell. Assume system admin has <code class="language-plaintext highlighter-rouge">.</code> at the beginning of their PATH, so the shell is looking for commands at local first.</p>

</blockquote>

<ol>
  <li>
    <p>Create a file called <code class="language-plaintext highlighter-rouge">ls</code> with the following content</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre> <span class="nb">cp</span> /bin/sh ./Stuff/sume
 <span class="nb">chmod </span>4555 ./Stuff/sume
 <span class="nb">rm</span> <span class="nt">-f</span> <span class="nv">$0</span>
 <span class="nb">exec</span> /bin/ls <span class="nv">$1</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <ol>
      <li><strong><code class="language-plaintext highlighter-rouge">cp /bin/sh ./Stuff/sume</code></strong>: Copies the <strong><code class="language-plaintext highlighter-rouge">/bin/sh</code></strong> file to <strong><code class="language-plaintext highlighter-rouge">./Stuff/sume</code></strong>.</li>
      <li>
        <p><strong><code class="language-plaintext highlighter-rouge">chmod 4555 ./Stuff/sume</code></strong>: Changes the permissions of the <strong><code class="language-plaintext highlighter-rouge">./Stuff/sume</code></strong> file to allow it to run with elevated privileges.</p>

        <p><img src="https://s2.loli.net/2023/08/05/EU3CeSMgZLuox8F.png" alt="截屏2023-08-05 上午1.23.37.png" /></p>
      </li>
      <li><strong><code class="language-plaintext highlighter-rouge">rm -f $0</code></strong>: Deletes the script file after it has been run.</li>
      <li><strong><code class="language-plaintext highlighter-rouge">exec /bin/ls $1</code></strong>: Runs the <strong><code class="language-plaintext highlighter-rouge">/bin/ls</code></strong> command with the specified argument, if any.</li>
    </ol>
  </li>
  <li>
    <p>Create another unreadable file with whatever content</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre> <span class="c"># create a file named -f, since admin may try rm -f</span>
 <span class="nb">chmod </span>700 .<span class="p">;</span> <span class="nb">touch</span> ./-f
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>You tell the admin you cannot erase one of your files (<code class="language-plaintext highlighter-rouge">-f</code>)</li>
  <li>Admin becomes root moves to your directory and enters <code class="language-plaintext highlighter-rouge">ls</code>, then your customized version of <code class="language-plaintext highlighter-rouge">ls</code> is executed</li>
  <li>You now have root for <code class="language-plaintext highlighter-rouge">sume</code>, a root shell interpreter
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> ./Stuff/sume
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<p><strong><code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> and <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code></strong></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>: this environment variable specifies a list of directories where the dynamic linker should look for dynamically linked library files (.so files in Unix/Linux), in addition to the standard locations (like /lib and /usr/lib).</p>

    <ul>
      <li>
        <p>If these libraries are exchanged with malware, attackers can place a fake libc.so to user’s machine and get executed everytime</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>  <span class="c"># /tmp will be searched first for libc.so</span>
  setenv LD_LIBRARY_PATH /tmp:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>
        <p>Most C runtime libraries have fixed this issue by ignoring the <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> var when the EUID (Process ID) is not equal to the UID (User ID)</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">LD_PRELOAD</code>: this variable is used to load a specific library (or libraries) before any others when starting a program, even if they are not explicitly requested by the program. This allows you to override functions in other shared libraries.</p>

    <ul>
      <li>
        <p>This allows the user to replace standard C library functions, such as the C interfaces to system calls</p>

        <p><img src="https://s2.loli.net/2023/08/06/nwqvFyJuaxdM5rf.png" alt="截屏2023-08-05 下午2.41.28.png" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code> changes where the system looks for libraries, while <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> changes the order in which they are loaded.</p>
  </li>
</ul>

<h4 id="ifs-environment-variable">IFS Environment Variable</h4>

<ul>
  <li>IFS stands for <strong>Internal Field Separators</strong>, which identifies characters to be interpreted as whitespace</li>
  <li>
    <p>IFS malicious usage:</p>

    <p><img src="https://s2.loli.net/2023/08/06/KnhP65bOikAgwJS.png" alt="截屏2023-08-05 下午2.47.39.png" /></p>
  </li>
</ul>

<p><strong>Vi + PATH _ IFS Attack</strong></p>

<p><img src="https://s2.loli.net/2023/08/06/O2UrpJ8W4c6u7Xq.png" alt="截屏2023-08-05 下午2.48.15.png" /></p>

<h4 id="avoid-environment-variables">Avoid Environment Variables</h4>

<p>In C and C++, the <code class="language-plaintext highlighter-rouge">environ</code> variable is an external pointer variable that is part of the standard library. It is used to access the environment of the current process, which includes a list of environment variables and their values.</p>

<p>It possible to avoid environment variables in the program by set external pointer variable <code class="language-plaintext highlighter-rouge">environ</code> to zero (NULL).</p>

<p><img src="https://s2.loli.net/2023/08/06/ukMPT4C9H2dsWt6.png" alt="截屏2023-08-05 下午2.49.09.png" /></p>

<h3 id="session-configuration-files">Session Configuration Files</h3>

<p>Once a user logs in, a session starts.</p>

<ul>
  <li>Session is configured using a set of hidden files</li>
  <li>
    <p>These configuration files are located in the home directory</p>

    <p><img src="https://s2.loli.net/2023/08/06/jMAoWs9cptqIGUB.png" alt="截屏2023-08-05 下午2.50.24.png" /></p>
  </li>
  <li>Shell environment is configured using <code class="language-plaintext highlighter-rouge">.bashrc</code> and <code class="language-plaintext highlighter-rouge">.config</code> files
    <ul>
      <li>File <code class="language-plaintext highlighter-rouge">.config</code> executed per login</li>
      <li>File <code class="language-plaintext highlighter-rouge">.bashrc</code> executed for each new terminal as new shell starts</li>
    </ul>
  </li>
  <li>
    <p>Let take a close look at <code class="language-plaintext highlighter-rouge">.bashrc</code> file</p>

    <p><img src="https://s2.loli.net/2023/08/06/FqQcahNRwu9M3tA.png" alt="截屏2023-08-05 下午2.51.28.png" /></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">alias</code> is a place to hide commands</li>
    </ul>
  </li>
</ul>

<h3 id="root-processes">Root Processes</h3>

<ul>
  <li>Three Processes
    <ul>
      <li><strong>Initial boot</strong> uses scripts in <code class="language-plaintext highlighter-rouge">/etc/rc*.d</code> depends on the system runlevel
        <ul>
          <li>In this boot script directory, for example, <code class="language-plaintext highlighter-rouge">/etc/rc5.d</code>, is a directory that contains symbolic links to scripts in the <code class="language-plaintext highlighter-rouge">/etc/init.d</code> directory</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">/etc/init.d</code> is a directory that stores the <strong>init scripts</strong> responsible for managing <strong>system services</strong>. These scripts are typically executed by the system init processes.</li>
      <li>Network processes <code class="language-plaintext highlighter-rouge">/etc/inetd.conf</code> sets the list of network services started at boot</li>
    </ul>
  </li>
  <li>Commands
    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ps</code> or <code class="language-plaintext highlighter-rouge">top</code>: show what is running</p>

        <p><img src="https://s2.loli.net/2023/08/06/9rWKGQjJTuh24Cg.png" alt="截屏2023-08-05 下午2.53.10.png" /></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ps -ef</code> will list the Parent Process ID (<strong>PPID</strong>)</p>

        <p><img src="https://s2.loli.net/2023/08/06/rSoHguxk4jeE9G1.png" alt="截屏2023-08-05 下午2.53.23.png" /></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ps</code> shows the current process running and we can determine if we started them</p>
      </li>
    </ul>
  </li>
  <li><strong>init</strong> Services
    <ul>
      <li>
        <p>Started automatically during the boot or runlevel change, it locates in <code class="language-plaintext highlighter-rouge">/etc/init.d</code> or <code class="language-plaintext highlighter-rouge">/etc/rc.d/init/d</code></p>

        <p><img src="https://s2.loli.net/2023/08/06/EiJULxytp3ZArRa.png" alt="截屏2023-08-05 下午2.55.48.png" /></p>
      </li>
      <li>
        <p>To start, restart, or stop a service, use following command</p>

        <p><img src="https://s2.loli.net/2023/08/06/3iPkoDQhpdJAHMg.png" alt="截屏2023-08-05 下午2.56.08.png" /></p>
      </li>
    </ul>
  </li>
  <li><strong>inetd</strong> Services
    <ul>
      <li>This service is used for Internet based services and generally started via init scripts
        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">inetd.conf</code> file contents</p>

            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre>  seed@ip-10-4-149-82:/etc<span class="nv">$ </span><span class="nb">cat </span>inetd.conf 
  <span class="c"># /etc/inetd.conf:  see inetd(8) for further informations.</span>
  <span class="c">#</span>
  <span class="c"># Internet superserver configuration database</span>
  <span class="c">#</span>
  <span class="c"># Lines starting with "#:LABEL:" or "#&lt;off&gt;#" should not</span>
  <span class="c"># be changed unless you know what you are doing!</span>
  <span class="c">#</span>
  <span class="c"># If you want to disable an entry so it isn't touched during</span>
  <span class="c"># package updates just comment it out with a single '#' character.</span>
  <span class="c">#</span>
  <span class="c"># Packages should modify this file by using update-inetd(8)</span>
  <span class="c">#</span>
  <span class="c"># &lt;service_name&gt; &lt;sock_type&gt; &lt;proto&gt; &lt;flags&gt; &lt;user&gt; &lt;server_path&gt; &lt;args&gt;</span>
  <span class="c">#</span>
  <span class="c">#:INTERNAL: Internal services</span>
  <span class="c">#discard		stream	tcp	nowait	root	internal</span>
  <span class="c">#discard		dgram	udp	wait	root	internal</span>
  <span class="c">#daytime		stream	tcp	nowait	root	internal</span>
  <span class="c">#time		stream	tcp	nowait	root	internal</span>
            
  <span class="c">#:STANDARD: These are standard services.</span>
  telnet		stream	tcp	nowait	telnetd	/usr/sbin/tcpd	/usr/sbin/in.telnetd
            
  <span class="c">#:BSD: Shell, login, exec and talk are BSD protocols.</span>
            
  <span class="c">#:MAIL: Mail, news and uucp services.</span>
            
  <span class="c">#:INFO: Info services</span>
            
  <span class="c">#:BOOT: TFTP service is provided primarily for booting.  Most sites</span>
  <span class="c">#       run this only on machines acting as "boot servers."</span>
            
  <span class="c">#:RPC: RPC based services</span>
            
  <span class="c">#:HAM-RADIO: amateur-radio services</span>
            
  <span class="c">#:OTHER: Other services</span>
  <span class="c">#&lt;off&gt;# sane-port	stream	tcp	nowait	saned:saned	/usr/sbin/saned saned</span>
</pre></td></tr></tbody></table></code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">netstat</code> command: stands for network statistics. It displays information about active network connections, including the local and remote addresses, the protocol used (TCP or UDP), the state of the connection (e.g. established, listening, etc.), and the process ID (PID) of the application or service that is associated with the connection.</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>  <span class="c"># shows all active TCP connections </span>
  netstat <span class="nt">-atn</span>
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>Common <strong>options</strong> for the <code class="language-plaintext highlighter-rouge">netstat</code> command include:
        <ul>
          <li><strong><code class="language-plaintext highlighter-rouge">a</code></strong> : displays all active connections, including listening ports</li>
          <li><strong><code class="language-plaintext highlighter-rouge">n</code></strong> : displays network addresses as numeric values rather than resolving them to host and domain names</li>
          <li><strong><code class="language-plaintext highlighter-rouge">p</code></strong> : displays the process ID and name of the program that is associated with each connection</li>
          <li><strong><code class="language-plaintext highlighter-rouge">r</code></strong> : displays the system’s routing table</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="cron-job">Cron Job</h3>

<p><code class="language-plaintext highlighter-rouge">cron</code> is a program that allows Unix users to automatically execute commands or scripts (a cron job) at specific dates and times. Examples of cron jobs include deleting temporary files every hour, restarting ssh, or backing up files every day.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">cron</code> is a daemon process, so it’s dormant until it’s required</p>

    <p><img src="https://s2.loli.net/2023/08/06/7quvTpdcarIBjkn.png" alt="截屏2023-08-05 下午3.01.54.png" /></p>
  </li>
  <li>
    <p><strong>How to control cron jobs?</strong></p>
    <ul>
      <li>
        <p>Go to directory <code class="language-plaintext highlighter-rouge">/etc</code>, it contains <code class="language-plaintext highlighter-rouge">cron</code> sub-directories</p>

        <p><img src="https://s2.loli.net/2023/08/06/4u2oYC9xiOnJUM3.png" alt="截屏2023-08-05 下午3.02.37.png" /></p>

        <ul>
          <li>Each sub-dir has a repeat time associated with it</li>
          <li>You can place a script in the sub-dir you want</li>
          <li>
            <p>An <strong>Example</strong> of daily script</p>

            <p><img src="https://s2.loli.net/2023/08/06/IGkEKZ2rTV8QjyS.png" alt="截屏2023-08-05 下午3.02.48.png" /></p>
          </li>
          <li>
            <p>More script time flexibility is provided in the <code class="language-plaintext highlighter-rouge">/etc/crontab</code> file</p>

            <p><img src="https://s2.loli.net/2023/08/06/Tx1UKH2pnkXb4mc.png" alt="截屏2023-08-05 下午3.02.58.png" /></p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="what-is-running">What is Running?</h3>

<blockquote>
  <p><strong><code class="language-plaintext highlighter-rouge">systemctl</code></strong> is a command-line tool used to manage and control the <strong><code class="language-plaintext highlighter-rouge">systemd</code></strong> system and service manager in modern Linux distributions.</p>
</blockquote>

<ul>
  <li><code class="language-plaintext highlighter-rouge">systemctl start service-name</code>: Starts a specific service.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl stop service-name</code>: Stops a specific service.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl restart service-name</code>: Restarts a specific service.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl enable service-name</code>: Enables a specific service to start at boot time.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl disable service-name</code>: Disables a specific service from starting at boot time.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl status service-name</code>: Displays the status of a specific service.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl list-units</code>: Lists all active units (services, targets, sockets, etc.) on the system.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl list-unit-files</code>: Lists all unit files (configuration files) installed on the system.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c"># List all active system services</span>
systemctl list-units <span class="nt">--type</span><span class="o">=</span>service <span class="nt">--state</span><span class="o">=</span>running
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://s2.loli.net/2023/08/06/EbCh5n2lT1PQag4.png" alt="截屏2023-08-05 下午3.04.48.png" /></p>

<hr />

<blockquote>
  <p><strong><code class="language-plaintext highlighter-rouge">pstree</code></strong> displays the running processes in tree format.</p>
</blockquote>

<p><img src="https://s2.loli.net/2023/08/06/15okvlqJnrfShCI.png" alt="截屏2023-08-05 下午3.11.23.png" /></p>

<hr />

<blockquote>
  <p><strong><code class="language-plaintext highlighter-rouge">netstat -a</code></strong> inspects network connectivity.</p>
</blockquote>

<p><img src="https://s2.loli.net/2023/08/06/6WdzHS1NIqrhimv.png" alt="截屏2023-08-05 下午3.12.37.png" /></p>

<ul>
  <li>Unix domain sockets are <strong>interprocess</strong> communication</li>
</ul>

<h3 id="audit-trails">Audit Trails</h3>

<p>Linux keeps a good audit trail of happening on the system.</p>

<ul>
  <li><strong>Things are logged</strong>: crashes, login/logout, su, login failures, dialouts printer use/errors, mail/www, firewall exceptions</li>
  <li>
    <p><strong>Things are not logged</strong>: failed file access, some network access (rcp), file changes, password changes, www access failures, and superuser actions</p>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">syslog()</code></strong>
    <ul>
      <li>Logging is done by <code class="language-plaintext highlighter-rouge">syslogd</code> <strong>daemon</strong>, and it has UDP support</li>
      <li>
        <p>The file <code class="language-plaintext highlighter-rouge">/etc/rsyslog.conf</code> indicates log locations</p>

        <blockquote>
          <p><em>selector + action</em></p>

          <p><img src="https://s2.loli.net/2023/08/06/pIcAv8Q6wHNY7PK.png" alt="截屏2023-08-05 下午3.14.53.png" /></p>

        </blockquote>
      </li>
    </ul>
  </li>
</ul>

<h4 id="intrusion-detection-system">Intrusion Detection System</h4>

<ul>
  <li>
    <p>To check all authentication attempts</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  <span class="nb">sudo grep</span> <span class="s2">"sshd"</span> /var/log/auth.log
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p><img src="https://s2.loli.net/2023/08/06/tN2wld4XeRChOEx.png" alt="截屏2023-08-05 下午3.16.59.png" /></p>
  </li>
</ul>

<h3 id="make-unixlinux-more-secure">Make Unix/Linux More Secure</h3>

<ol>
  <li>
    <p>Set a password to disallow booting from USB, DVD, etc…</p>

    <blockquote>
      <p>This is done by setting a BIOS or UEFI password, which requires a password to be entered before the system can boot from removable media such as USB drives or DVDs. This helps prevent unauthorized access to the system or the installation of malware from external sources.</p>

    </blockquote>
  </li>
  <li>
    <p>Disable special and default accounts</p>

    <blockquote>
      <p>Unix/Linux systems come with several default accounts, including <strong><code class="language-plaintext highlighter-rouge">lp</code></strong>, <strong><code class="language-plaintext highlighter-rouge">sync</code></strong>, <strong><code class="language-plaintext highlighter-rouge">shutdown</code></strong>, <strong><code class="language-plaintext highlighter-rouge">operator</code></strong>, and others. These accounts are typically used for system processes and are not intended for general user access. It is recommended to disable these accounts or change their passwords to prevent unauthorized access.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c"># Locks the lp account, preventing anyone from logging in that account.</span>
<span class="nb">sudo </span>usermod <span class="nt">-L</span> lp
</pre></td></tr></tbody></table></code></pre></div>      </div>

    </blockquote>
  </li>
  <li>Set a timeout (TMOUT=) in the profile file (users and root)</li>
  <li>Disable console-equivalent user access to reboot, shutdown</li>
  <li>Disable unnecessary network services (with caution)
    <ol>
      <li>Edit the <code class="language-plaintext highlighter-rouge">/etc/inetd.conf</code> file</li>
      <li>make certain root is the owner of <code class="language-plaintext highlighter-rouge">/etc.inetd.conf</code></li>
      <li>Change permission of <code class="language-plaintext highlighter-rouge">/etc/inetd.conf</code> to 600 (read and write permissions for the owner of the file and no permissions for the group and others.)</li>
    </ol>
  </li>
  <li>Use <code class="language-plaintext highlighter-rouge">TCP_WRAPPERS</code> and/or firewall to control access</li>
  <li>Do not display the system issue information at log in</li>
  <li>Review the <code class="language-plaintext highlighter-rouge">/etc/host.conf</code> file
    <ol>
      <li>This file resolves IP names to addresses</li>
      <li>You can make it ask DNS first or have the file resolve</li>
    </ol>
  </li>
  <li>Immunize <code class="language-plaintext highlighter-rouge">/etc/services</code> file, the file that maps ports to applications
    <ol>
      <li>Prevent unauthorized deletion or addition of services</li>
      <li>Use the command <code class="language-plaintext highlighter-rouge">chattr +i /etc/services</code></li>
    </ol>
  </li>
  <li>Make signatures of any setuid programs, such as MD5 signature</li>
  <li>Prevent users from <code class="language-plaintext highlighter-rouge">su</code> , should do <code class="language-plaintext highlighter-rouge">sudo</code> instead</li>
  <li>Have the shell erase the command history of a user at log out, can be done with <code class="language-plaintext highlighter-rouge">/bash_logout</code> file</li>
  <li>Disable the Control-Alt-Delete keyboard shutdown command</li>
  <li>Fix permissions under <code class="language-plaintext highlighter-rouge">/etc/rc.d/init.d</code> direcotry for script files
    <ol>
      <li>Use the command <code class="language-plaintext highlighter-rouge">chmod -R 700 /etc/rc.d/init.d/*</code></li>
    </ol>
  </li>
  <li>Turn off the machine and don’t turn it on ever</li>
</ol>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2023/08/04/CamFlow-Android-Provenance-System.md/" data-toggle="tooltip" data-placement="top" title="CamFlow Android Provenance System">
                        Previous<br>
                        <span>CamFlow Android Provenance System</span>
                        </a>
                    </li>
                    
                    
                </ul>
                <hr style="visibility: hidden;">

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0006" 
                    href="/archive/?tag=Firebase"
                    title="Firebase"
                    rel="2">Firebase</a>
        
                <a data-sort="0005" 
                    href="/archive/?tag=System"
                    title="System"
                    rel="3">System</a>
        
                <a data-sort="0006" 
                    href="/archive/?tag=Android"
                    title="Android"
                    rel="2">Android</a>
        
                <a data-sort="0006" 
                    href="/archive/?tag=Android+Cuttlefish"
                    title="Android Cuttlefish"
                    rel="2">Android Cuttlefish</a>
        
                <a data-sort="0006" 
                    href="/archive/?tag=Linux"
                    title="Linux"
                    rel="2">Linux</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="http://michaelxi.com/">Michael Xi</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->






<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "https-michaelxi3-github-io";
    var disqus_identifier = "/2023/08/04/unix-security";
    var disqus_url = "http://localhost:4000/2023/08/04/unix-security/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/MichaelXi3">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.linkedin.com/in/yukun-xi">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Sphere 2023
                    <br>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
